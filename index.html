<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Grid Interativo</title>
    <style>
      * {
        box-sizing: border-box;
      }

.token {
  width: 50px;
  height: 50px;
  transition: transform 0.3s ease, left 0.3s ease, top 0.3s ease;
}
.cell {
  position: relative;
}

      body,
      html {
        margin: 0;
        padding: 0;
        height: 100vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }

      #controls {
        padding: 10px;
        background: #eee;
        display: flex;
        gap: 10px;
      }

      #grid {
        background-size: cover;
        background-image: url(./assets/background.jpeg);
        flex: 1;
        display: grid;
        width: 100%;
        height: 100%;
      }

      .cell {
        border: 1px solid #ccc;
        position: relative;
        aspect-ratio: 1 / 1;
      }

      .token {
        position: absolute;
        width: 100%;
        height: 100%;
        object-fit: contain;
        cursor: grab;
        z-index: 10;
      }
    </style>
  </head>
  <body>
    <div id="controls">
      <button onclick="changeGridSize(-1)">Aumentar Grid</button>
      <button onclick="changeGridSize(1)">Diminuir Grid</button>
    </div>

    <div id="grid"></div>

    <script>
      let gridSize = 6; // Começa com 6x6
      const grid = document.getElementById("grid");

      let draggedToken = null;

      // Lista de tokens que você quer adicionar
      const tokenSources = [
        "assets/token-1.png",
        "assets/token-2.png",
        "assets/token-3.png",
        "assets/token-4.png",
      ];

      // Função para criar um token
      function createToken(src) {
        const token = document.createElement("img");
        token.src = src;
        token.classList.add("token");
        token.setAttribute("draggable", "true");

        token.addEventListener("dragstart", (e) => {
          draggedToken = e.target;
          setTimeout(() => (draggedToken.style.display = "none"), 0);
        });

        token.addEventListener("dragend", () => {
          draggedToken.style.display = "block";
          draggedToken = null;
        });

        return token;
      }

      function createGrid() {
        grid.innerHTML = "";
        grid.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
        const totalCells = gridSize * gridSize;

        for (let i = 0; i < totalCells; i++) {
          const cell = document.createElement("div");
          cell.classList.add("cell");

          cell.addEventListener("dragover", (e) => {
            // Só permite arrastar sobre a célula se ela estiver vazia
            if (!cell.querySelector(".token")) {
              e.preventDefault();
            }
          });

          cell.addEventListener("drop", () => {
            if (draggedToken && !cell.querySelector(".token")) {
              cell.appendChild(draggedToken);
            }
          });

          grid.appendChild(cell);
        }

        // Posiciona os tokens nas primeiras células livres
        tokenSources.forEach((src, index) => {
          const token = createToken(src);
          const emptyCell = Array.from(grid.children).find(
            (cell) => !cell.hasChildNodes()
          );
          if (emptyCell) emptyCell.appendChild(token);
        });
      }

      function changeGridSize(delta) {
        gridSize = Math.max(2, Math.min(16, gridSize + delta));
        createGrid();
      }

      // Suporte a toque (mobile)
      grid.addEventListener(
        "touchstart",
        (e) => {
          const touch = e.touches[0];
          const touchedElement = document.elementFromPoint(
            touch.clientX,
            touch.clientY
          );

          if (touchedElement && touchedElement.classList.contains("token")) {
            draggedToken = touchedElement;
          }
        },
        { passive: false }
      );

      grid.addEventListener("touchend", (e) => {
        if (!draggedToken) return;

        const touch = e.changedTouches[0];
        const target = document.elementFromPoint(touch.clientX, touch.clientY);

        if (
          target &&
          target.classList.contains("cell") &&
          !target.querySelector(".token")
        ) {
          target.appendChild(draggedToken);
        }

        draggedToken = null;
      });
function animateTokenMove(token, targetCell) {
  const startRect = token.getBoundingClientRect();
  const endRect = targetCell.getBoundingClientRect();

  const deltaX = endRect.left - startRect.left;
  const deltaY = endRect.top - startRect.top;

  const clone = token.cloneNode(true);
  clone.style.position = "fixed";
  clone.style.left = startRect.left + "px";
  clone.style.top = startRect.top + "px";
  clone.style.width = startRect.width + "px";
  clone.style.height = startRect.height + "px";
  clone.style.transition = "transform 0.3s ease";
  clone.style.pointerEvents = "none";
  document.body.appendChild(clone);

  // Oculta o token original temporariamente
  token.style.visibility = "hidden";

  // Força reflow para aplicar a transição
  requestAnimationFrame(() => {
    clone.style.transform = `translate(${deltaX}px, ${deltaY}px)`;

    // Após a transição
    setTimeout(() => {
      targetCell.appendChild(token);
      token.style.visibility = "visible";
      document.body.removeChild(clone);
    }, 300);
  });
}
      createGrid();

    </script>
  </body>
</html>
